---
alwaysApply: true
---

# PLS Development Workflow

## üéØ Core Commands

### DEVELOP - Start Working
**Use when:** Beginning new work or resuming development

**Actions:**
1. **Check for handoff context** - If user provides a handoff message from previous session, read and understand it first
2. Get context from codebase
3. Review current state and recent changes (check git status, recent commits)
4. Understand requirements and scope
5. Plan implementation approach
6. Create todo list if needed

**Standard Process:**
- **If handoff message exists:** Read it first to understand what was done and what's pending
- Read relevant files and documentation
- Understand current architecture
- Check git status for uncommitted changes
- Review recent commits to understand recent work
- Identify dependencies
- Plan step-by-step implementation
- **If resuming:** Start with the pending tasks from handoff message

---

### RELEASE - Commit, Push, Tag, Update
**Use when:** Ready to release a version

**MANDATORY STEPS (ALL must be completed):**

#### 1. Update Version (3 files)
```php
// pls-private-label-store.php
* Version: 1.2.3
define( 'PLS_PLS_VERSION', '1.2.3' );
```

```txt
// readme.txt
Stable tag: 1.2.3
```

```json
// uupd/index.json
{
  "version": "1.2.3",
  "last_updated": "2026-01-18 23:30:00"
}
```

#### 2. Update Changelog (2 files)
- Add version section to `readme.txt`
- Add to `"changelog"` field in `uupd/index.json`

#### 3. Standardized Git Operations
**IMPORTANT: When committing, ALWAYS create and push tag automatically!**

```bash
git add -A
git commit -m "Release v1.2.3: Brief description of changes"
git tag -a v1.2.3 -m "Release v1.2.3"
git push origin main
git push origin v1.2.3  # This triggers GitHub Actions workflow!
```

**Or use the automated script:**
```powershell
.\push-with-tag.ps1
```

**The tag push is CRITICAL** - it triggers the GitHub Actions workflow that builds the ZIP and creates the release for UUPD updates.

#### 4. Wait for GitHub Actions
- Wait 1-2 minutes for workflow to complete
- Verify release at: https://github.com/centrino97/pls-private-label-store/releases

**Standard Commit Message Format:**
```
Release vX.Y.Z: Brief feature description

- Feature 1: Description
- Feature 2: Description
- Bug fix: Description
- Updated version to X.Y.Z in all files
```

---

### STOP - Stop Working, Record Context
**Use when:** Pausing work or completing a session

**CRITICAL OUTPUT:** Generate a ready-to-paste handoff message for the next agent session.

**Actions:**
1. Document current state
2. Record what was completed
3. Note what remains to be done
4. Save any important context or decisions
5. Commit any uncommitted work (if appropriate)
6. **Generate handoff message** (see format below)

**Standard Process:**
- Summarize completed work
- List pending tasks
- Note any blockers or decisions made
- Update documentation if needed
- **Generate formatted handoff message**

**Handoff Message Format:**
When user says "STOP" or "CLOSE", generate a formatted message like this:

```
## Session Handoff - PLS Development

### ‚úÖ Completed This Session
- [List what was actually completed]
- [Specific files changed]
- [Features implemented]

### üîÑ Current State
- [What's working]
- [What's partially done]
- [Current version: X.Y.Z]

### üìã Pending Tasks / Next Steps
- [What needs to be done next]
- [Known issues to address]
- [Planned features]

### üö® Important Context / Decisions
- [Any architectural decisions made]
- [Important notes for next developer]
- [Files to pay attention to]

### üìÅ Key Files Modified
- `path/to/file1.php` - [what changed]
- `path/to/file2.js` - [what changed]

### üéØ Ready to Continue
When you start, use DEVELOP command to get full context, then continue with [specific next task].
```

**The handoff message should be:**
- Complete enough for a new agent to understand the full context
- Include specific file paths and what changed
- List clear next steps
- Note any important decisions or gotchas
- Ready to copy/paste into a new Cursor chat

---

## üìã Standardized Commit Messages

### Format
```
<type>: <description>

<optional detailed explanation>
```

### Types
- `Release vX.Y.Z:` - Version release (must include version bump)
- `Feature:` - New feature implementation
- `Fix:` - Bug fix
- `Refactor:` - Code refactoring
- `Docs:` - Documentation updates
- `Style:` - Code style/formatting changes
- `Test:` - Test additions/updates

### Examples
```
Release v1.2.3: Enhanced sample data with full product options

- Products now include complete product options (Package Type, Color, Cap, Fragrances)
- Added bundle-qualified orders for testing
- Updated version to 1.2.3 in all files
```

```
Feature: Add tiered commission calculation for custom orders

- Implemented threshold-based commission rates
- Added settings UI for threshold and rates
- Auto-calculates commission when order status changes to Done
```

```
Fix: Correct bundle commission calculation in order processing

- Fixed bundle key parsing for commission lookup
- Corrected units calculation for bundle items
```

---

## üö® CRITICAL Release Checklist

**MISSING ANY STEP = Update NOT visible to users!**

- [ ] Code changes completed and tested
- [ ] Version bumped in `pls-private-label-store.php` (line 5 AND line 20)
- [ ] Version bumped in `readme.txt` (`Stable tag:`)
- [ ] Version bumped in `uupd/index.json` (`version` field)
- [ ] `last_updated` timestamp updated in `uupd/index.json`
- [ ] Changelog added to `readme.txt`
- [ ] Changelog added to `uupd/index.json`
- [ ] Committed with standardized message: `git commit -m "Release vX.Y.Z: Description"`
- [ ] Tagged: `git tag vX.Y.Z`
- [ ] Pushed branch: `git push origin main`
- [ ] Pushed tag: `git push origin vX.Y.Z`
- [ ] Waited 1-2 minutes for GitHub Actions
- [ ] Verified release exists with ZIP file

---

## üîÑ Release Workflow

### Step-by-Step Process

1. **Complete Development**
   - All code changes done
   - Testing completed
   - Documentation updated

2. **Version Bump (3 files)**
   - `pls-private-label-store.php`: Header + constant
   - `readme.txt`: Stable tag
   - `uupd/index.json`: Version + timestamp

3. **Changelog Update (2 files)**
   - `readme.txt`: Add version section
   - `uupd/index.json`: Add to changelog field

4. **Git Operations (AUTOMATIC TAG CREATION)**
   ```bash
   git add -A
   git commit -m "Release vX.Y.Z: Description"
   git tag -a vX.Y.Z -m "Release vX.Y.Z"  # Create annotated tag
   git push origin main
   git push origin vX.Y.Z  # CRITICAL: Tag push triggers GitHub Actions!
   ```
   
   **AI Assistant MUST:** Automatically create and push tag when committing version changes. This ensures the GitHub Actions workflow runs and builds the release ZIP for UUPD updates.

5. **Verify Release**
   - Check GitHub Actions: https://github.com/centrino97/pls-private-label-store/actions
   - Verify release: https://github.com/centrino97/pls-private-label-store/releases
   - Confirm ZIP file attached

---

## üìÅ File Locations

### Version Files
- `pls-private-label-store.php` - Plugin header + version constant
- `readme.txt` - Stable tag + changelog
- `uupd/index.json` - Version + changelog + metadata

### Key URLs
- **JSON:** `https://raw.githubusercontent.com/centrino97/pls-private-label-store/main/uupd/index.json`
- **ZIP:** `https://github.com/centrino97/pls-private-label-store/releases/latest/download/pls-private-label-store.zip`
- **Releases:** `https://github.com/centrino97/pls-private-label-store/releases`
- **Actions:** `https://github.com/centrino97/pls-private-label-store/actions`

---

## ‚ö†Ô∏è Common Mistakes

1. **Forgetting to bump version in `uupd/index.json`**
   - Result: Update not detected
   - Fix: Always update version AND timestamp

2. **Not pushing the tag**
   - Result: GitHub Actions doesn't run, no ZIP built
   - Fix: Always push both branch AND tag

3. **Not updating `last_updated` timestamp**
   - Result: WordPress cache may not refresh
   - Fix: Always update timestamp when bumping version

4. **Incomplete changelog**
   - Result: Users don't know what changed
   - Fix: Add changelog to both files

5. **Wrong commit message format**
   - Result: Hard to track releases
   - Fix: Use standardized format: `Release vX.Y.Z: Description`

---

## ü§ñ AUTOMATIC TAG CREATION ON COMMIT

**CRITICAL: When user asks to commit, ALWAYS automatically create and push a tag if:**
- Version files (`pls-private-label-store.php`, `readme.txt`, `uupd/index.json`) have been modified, OR
- Commit message contains "Release v" or version number, OR
- User explicitly requests a release/version update

**Automatic Tag Process:**
1. Extract version from `pls-private-label-store.php` (look for `Version: X.Y.Z` or `PLS_PLS_VERSION`)
2. Create tag: `git tag -a vX.Y.Z -m "Release vX.Y.Z"`
3. Push commits first: `git push origin main`
4. Push tag: `git push origin vX.Y.Z`
5. Inform user that GitHub Actions will trigger automatically

**Why:** Tags trigger GitHub Actions workflow which builds the ZIP and creates the release for UUPD updates. Without a tag, the workflow doesn't run and users won't see updates.

**Use `push-with-tag.ps1` script if available:** The script automates this entire process safely.

---

## üéØ Golden Rules

1. **ALWAYS bump version in ALL 3 files + update timestamp + push tag = Update visible**
2. **MISSING ANY STEP = Update NOT visible**
3. **Use standardized commit messages for releases**
4. **ALWAYS create and push tag when committing version changes** (triggers GitHub Actions)
5. **Wait 1-2 minutes after pushing tag before verifying**
6. **Users must click "Check for updates" in WordPress**

---

## üìö Quick Reference

### Version Format
- Semantic versioning: `MAJOR.MINOR.PATCH`
- Examples: `1.2.0`, `1.2.1`, `1.2.2`
- Major: Breaking changes
- Minor: New features (backward compatible)
- Patch: Bug fixes

### Tag Format
- Always prefix with `v`: `v1.2.3`
- Must match version exactly

### Timestamp Format
- `YYYY-MM-DD HH:MM:SS`
- Example: `2026-01-18 23:30:00`
- Use 24-hour format

---

## üîç Troubleshooting

### Update Not Detected
1. Check all 3 version files match
2. Verify tag exists: `git tag --list | grep vX.Y.Z`
3. Check release exists on GitHub
4. Verify JSON accessible at raw URL
5. Clear WordPress transients or wait for cache expiration

### ZIP Not Built
1. Check GitHub Actions workflow ran
2. Verify tag was pushed: `git ls-remote --tags origin`
3. Check workflow logs for errors
4. Manually create release if needed

### Workflow Not Triggered
1. Verify tag format: Must start with `v`
2. Check `.github/workflows/build-release-zip.yml` exists
3. Verify tag was pushed: `git push origin vX.Y.Z`
4. Check GitHub Actions tab for workflow status
